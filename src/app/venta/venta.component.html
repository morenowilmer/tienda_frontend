<section class="venta-area">
  <h3>Editar Persona</h3>
  <form [formGroup]="formularioBusquedaPersona" (ngSubmit)="onBuscarPersona()" class="venta-form">
    <div class="row">
      <div class="field">
        <label>Tipo de documento</label>
        <select formControlName="tipoDocumento">
          <option value="">-- Seleccione --</option>
          <option *ngFor="let tipoDoc of tiposDocumento" [value]="tipoDoc.id">{{ tipoDoc.nombre }}</option>
        </select>
        <div class="error" *ngIf="f['tipoDocumento'].touched && f['tipoDocumento'].invalid">
          <div *ngIf="f['tipoDocumento'].errors?.['required']">Seleccione un tipo de documento.</div>
        </div>
      </div>

      <div class="field">
        <label>Identificación</label>
        <input type="text" formControlName="identificacion" placeholder="Número de identificación" />
        <div class="error" *ngIf="f['identificacion'].touched && f['identificacion'].invalid">
          <div *ngIf="f['identificacion'].errors?.['required']">La identificación es obligatoria.</div>
          <div *ngIf="f['identificacion'].errors?.['maxlength']">Máximo 30 caracteres.</div>
        </div>
      </div>
    </div>

    <div class="actions">
      <button type="submit" class="btn primary">Buscar</button>
      <button type="button" class="btn" (click)="onLimpiar()">Limpiar</button>
    </div>
  </form>
</section>
<br>
<section class="venta-area">
  <h3>Venta</h3>
  <h5>Comprador: {{ personaCompradora?.nombre }} {{ personaCompradora?.apellido }} - {{ personaCompradora?.identificacion }}</h5>
  <form [formGroup]="formularioBuscar" class="buscador" (ngSubmit)="$event.preventDefault()">
    <label>Buscar producto</label>
    <input type="text" formControlName="nombre" placeholder="Ingrese al menos 3 letras" />
    <div class="search-results" *ngIf="productosEncontrados?.length">
      <ul class="results-list">
        <li *ngFor="let p of productosEncontrados" (click)="seleccionarProducto(p)">
          <strong>{{p.nombre}}</strong> <span *ngIf="p.descripcion">- {{p.descripcion}}</span>
        </li>
      </ul>
    </div>
  </form>

  <form [formGroup]="formularioProducto" class="fila-producto" (ngSubmit)="agregar()">
    <label>Producto</label>
    <input formControlName="nombre" readonly />
    <label>Valor</label>
    <input type="number" formControlName="valor" />
    <label>Cantidad</label>
    <input type="number" formControlName="cantidad" min="1" />
    <button type="button" class="btn primary" (click)="agregar()">Agregar</button>
  </form>

  <table class="tabla-carrito">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Valor unidad</th>
        <th>Cantidad</th>
        <th>Valor sin impuestos</th>
        <th>Impuestos</th>
        <th>Valor total</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let it of carrito">
        <td>{{it.nombre}}</td>
        <td>{{it.valor | number:'1.0-2'}}</td>
        <td>{{it.cantidad}}</td>
        <td>{{it.sinImpuestos | number:'1.0-2'}}</td>
        <td>{{it.impuestos | number:'1.0-2'}}</td>
        <td>{{it.total | number:'1.0-2'}}</td>
      </tr>
    </tbody>
  </table>

  <div class="resumen">
    <div class="total-label">Total</div>
    <div class="total-value">{{ getTotal() | number:'1.0-2' }}</div>
  </div>

  <div class="acciones">
    <button class="btn primary" (click)="guardarCompra()">Guardar compra</button>
  </div>
</section>
